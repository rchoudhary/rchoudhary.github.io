<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"  lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <script type="text/javascript" src="/js/custom.js"></script>
  
    <title>Debugging a 555 Circuit | Null Pointers</title>
  
  
  
  <link rel="stylesheet" href="/css/style.css"/><link rel='stylesheet' href='https://rchoudhary.github.io/css/custom.css'><link rel="preload" href="/logo.png" as="image">
  <link rel="preload" href="/logo_dark.png" as="image">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  </script>
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
    });
  </script>
</head>
<body style="display: block">
<section class="section">
  <div class="container">
    <nav class="nav">
      <div class="nav-left">
        <a class="nav-item" id="site-title" href="https://rchoudhary.github.io">
            <h1 style="font-size: 36px;">Null Pointers</h1>
        </a>
      </div>
      <div class="nav-right">
        <nav class="nav-item level is-mobile"><a class="level-item" aria-label="github" href='https://github.com/rchoudhary' target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/>
    
  </svg></i>
            </span>
          </a></nav>
      </div>
    </nav>

    <nav class="nav">
      

      
    </nav>

  </div>
</section>

<section class="section">
  <div class="container">
    <div class="subtitle tags is-6 is-pulled-right">
      
    </div>
    
      <h2 class="subtitle is-6">Nov 24, 2019</h2>
    
    <h1 class="title">Debugging a 555 Circuit</h1>
    
    <div class="content" id="content">
      <h1 id="summary">Summary</h1>
      While building a 555 astable timer circuit, I noticed that the value of a seemingly unrelated resistor was actually of crucial importance to the overall functionality. Using simple circuit analysis and simulation, I got to the bottom of why exactly this resistor matters. It turns out that the resistor helps control the asymptotic behavior of a capacitor that in turn controls the timing behavior of the 555.
      <h1 id="toc">Table of Contents</h1>
      <nav id="TableOfContents">
<ul>
<li><a href="#the-setup">The Setup</a></li>
<li><a href="#background-reading">Background Reading</a></li>
<li><a href="#debugging-the-circuit">Debugging the Circuit</a></li>
<li><a href="#a-first-attempt-at-a-fix">A First Attempt at a Fix</a></li>
<li><a href="#why-is-charging-quicker-than-discharging">Why Is Charging Quicker Than Discharging?</a></li>
<li><a href="#a-naive-fix">A Naive Fix</a></li>
<li><a href="#a-better-fix">A Better Fix</a></li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
</nav>
      

<h1 id="the-setup">The Setup</h1>

<p>I bought some 555 timers and figured I would make an LED blink. I chose a frequency of $2\text{ Hz}$ just because and a duty cycle of $50\%$ because to me that&rsquo;s most visually appealing.</p>

<p>According to <a href="https://www.electronics-tutorials.ws/waveforms/555_oscillator.html">this tutorial</a>, all I needed to do was build this circuit:</p>

<p><img src="https://www.electronics-tutorials.ws/wp-content/uploads/2018/05/waveforms-tim58a.gif#c" alt="555 50% duty cycle oscillator" /></p>

<div class="figure-caption">Reference: <a href="https://www.electronics-tutorials.ws/waveforms/555_oscillator.html">Electronics Tutorials</a></div>

<p>&nbsp;</p>

<p>To get any particular frequency $f$, I simply needed to utilize the formula</p>

<p>$$ f=\frac{1}{0.693(2R_2)C_1}\,\mathrm{ Hz} $$</p>

<p>Using my impeccable algebra skills, I figured out that to get a $2 \text{ Hz}$ wave I needed</p>

<p>$$ R_2C_1 \approx 0.360$$</p>

<p>I looked through my electronics parts to see what values capacitors and resistors I had:</p>

<p><img src="/images/555-R1/res_values.png#c" height="270px"/>
<img src="/images/555-R1/cap_values.png#c" height="270px"/>
<div class="figure-caption">The resistors and capacitors I had lying around</div></p>

<p>Just from eyeballing it, a $330\text{ nF}$ capacitor and a $1\text{ MΩ}$ resistor would do the trick. In fact, if we plug in those values, we get $f \approx 2.186\text{ Hz}$. Good enough!</p>

<p>For $C_2$, I didn&rsquo;t have a $0.01\text{ µF}$ capacitor, but I did have a $0.1\text{ µF}$ capacitor. It&rsquo;s just there to stabilize the voltage on the <code>CONTROL</code> pin, so also good enough!</p>

<p>The question now was what to do about $R_1$. How big or small should it be? The tutorial doesn&rsquo;t say much:</p>

<blockquote>
<p>Note that resistor R1 needs to be sufficiently high enough to ensure it does not interfere with the charging of the capacitor to produce the required 50% duty cycle</p>
</blockquote>

<p>Is $100\text{ kΩ}$ &ldquo;sufficiently high enough?&rdquo; It seemed pretty big to me, and I mean that&rsquo;s what the picture used anyways. I went ahead built the circuit (after quite a bit of labor) to test it out:</p>

<p><img src="/images/555-R1/555_100k.jpg#c" height="300px"/>
<div class="figure-caption">Pretty good lookin&rsquo; huh?</div></p>

<p>I powered it up, but whenever I turned the circuit on, the LED would flash briefly and then never turn on again. This would happen every time I connected the circuit to power:</p>

<p><img src="/images/555-R1/555_100k_animation.gif#c" height="325px"/>
<div class="figure-caption">Kind of a lame circuit...</div></p>

<p>I double- and triple-checked the wiring, but couldn&rsquo;t find anything wrong! I figured just mindlessly quadruple-checking was gonna be useless. I needed to Get Smart™️</p>

<h1 id="background-reading">Background Reading</h1>

<p>I&rsquo;m gonna offload the work of explaining how the astable configuration of a 555 works to this guy&rsquo;s video. The relevant part starts at 6:54 (maybe watch at 1.5x speed).</p>

<div style="text-align: center;">
<iframe width="560" height="315" src="https://www.youtube.com/embed/i0SNb__dkYI?rel=0&amp;start=414" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
</div>

<h1 id="debugging-the-circuit">Debugging the Circuit</h1>

<p>Unfortunately, I didn&rsquo;t have an oscilloscope lying around (on account of them being expensive), so I settled for simulation using <a href="http://www.analog.com/en/design-center/design-tools-and-calculators/ltspice-simulator.html">LTSpice</a> (which is free).</p>

<p>In LTSpice I created the schematic for my circuit:</p>

<p><img src="/images/555-R1/schematic.png#c" height="350px"/></p>

<p>I then simulated it for a second and got the following results. The blue line is the voltage at the <code>OUT</code> pin and the green line is the voltage across the capacitor, i.e. the voltage at the <code>THRESHOLD</code> pin.</p>

<p><img src="/images/555-R1/graph_100k.png#c" height="400px"/>
<div class="figure-caption">The <code>OUT</code> pin goes high for just a bit then turns off, never to turn on again</div></p>

<p>After close inspection, I was curious as to why the capacitor topped out at $4.5\text{ V}$. After all, it&rsquo;s connected to the $5\text{ V}$ supply, so it should asymptotically approach $5\text{ V}$ right?</p>

<p>The trick was to think of the circuit more like this:</p>

<p><img src="/images/555-R1/C1_circuit.png#c" height="250px"/>
<div class="figure-caption">I hand draw my circuits &lsquo;cause I think it adds a certain charm</div></p>

<p>If there&rsquo;s one thing my undergrad degree taught me, it&rsquo;s recognizing voltage dividers, and boy howdy, $R_1$ and $R_2$ kinda look like one! From there it&rsquo;s fairly straightforward to see what the issue is:</p>

<p><span class="num-circle">1</span>$C_1$ starts out discharged and so the <code>THRESHOLD</code> pin is low. This causes <code>OUT</code> to start out high.</p>

<p><span class="num-circle">2</span>$C_1$ charges up through both resistors.
<img src="/images/555-R1/C1_charging.png#c" height="335px"/></p>

<p><span class="num-circle">3</span>$C_1$ evenutally brings <code>THRESHOLD</code> up to ${2}/{3}\ V_{CC}$, and so the <code>OUT</code> pin goes low.</p>

<p><span class="num-circle">4</span><code>OUT</code> now acts as a ground, so $R_1$ and $R_2$ form a voltage divider. Since $C_1$ is connected to the output of the voltage divider, it will charge up to the value of the divider.</p>

<p><img src="/images/555-R1/C1_volt_div.png#c" height="300px"/></p>

<p>We can easily calculate what the steady-state voltage of $C_1$ will be:
$$ V_{C_1} = \frac{R_2}{R_1+R_2} \times V_{CC} = \frac{10^6Ω}{10^3Ω+10^6Ω} \times 5 \text{V} \approx 4.545 \text{ V} $$
That explains why $C_1$ stabilizes at roughly $4.5\text{ V}$</p>

<p><span class="num-circle">5</span>Now nothing will change. In order for the <code>OUT</code> pin to toggle, the <code>THRESHOLD</code> pin needs to reach ${1}/{3}\ V_{CC}$. Unfortunately, the voltage divider keeps $C_1$ at $4.5\text{ V}$.</p>

<h1 id="a-first-attempt-at-a-fix">A First Attempt at a Fix</h1>

<p>The fix appears to be simple: <span class="highlight">pick a value of $R_1$ such that $C_1$ stabilizes at a voltage below ${1}/{3}\ V_{CC}$</span></p>

<p>A nice choice would be $3\text{ MΩ}$. We can verify that this works by again calculating what the output of the voltage divider would be:</p>

<p>$$ \frac{1\text{ MΩ}}{3\text{ MΩ}+1\text{ MΩ}} \times V_{CC} = {1}/{4}\ V_{CC} &lt; {1}/{3}\ V_{CC} $$</p>

<p>It&rsquo;s worth noting that $C_1$&rsquo;s voltage won&rsquo;t ever actually reach ${1}/{4}\ V_{CC}$ since as soon as it reaches ${1}/{3}\ V_{CC}$, the <code>OUT</code> pin will become high and the capacitor will start charging again.</p>

<p>I used the new value of $R_1$ and tested out the circuit:</p>

<p><img src="/images/555-R1/555_3M_animation.gif#c" height="325px"/>
<div class="figure-caption">The duty cycle doesn&rsquo;t seem quite right...</div></p>

<p>I was &ldquo;done&rdquo; in the sense that I at least now have a $2\text{-ish Hz}$ wave (I checked by timing it with a stopwatch), but the pulsing didn&rsquo;t look symmetric. To test this hunch, I simulated the circuit with $R_1=3\text{ MΩ}$ and got the following graph:</p>

<p><img src="/images/555-R1/graph_3m.png#c" height="400px"/>
<div class="figure-caption">Simulation shows the capacitor waveform (green) is asymmetric</div></p>

<p>Well, that most certainly is <strong>not</strong> a 50% duty cycle! 😠 It seems that $C_1$ spends more time discharging than it does charging. Weird...</p>

<h1 id="why-is-charging-quicker-than-discharging">Why Is Charging Quicker Than Discharging?</h1>

<p>Let&rsquo;s look at just the charging phase for a second since what we&rsquo;ll discover generalizes pretty easily to the discharging phase.</p>

<p>Capacitors charge according to exponential functions, which means that whatever voltage they&rsquo;re trying to charge to, what we will from now on will refer to as the <strong>target voltage</strong>, they&rsquo;ll approach <em>asymptotically</em>. So they&rsquo;ll never quite reach that voltage, and in fact, the closer they get to that voltage, the <em>slower</em> they&rsquo;ll charge.</p>

<p>Let&rsquo;s quickly recall that the charging phase ends when the capcitor hits the high cutoff voltage, ${2}/{3}\ V_{CC}\approx 3.33\text{ V}$. We&rsquo;ll now proceed by looking at two extremes.</p>

<p><span class="num-circle">1</span> What if the target voltage were <em>just</em> above the cutoff voltage, say at $3.34\text{ V}$? Well, when the capacitor voltage starts approaching the cutoff, it&rsquo;s basically starting to approach the target voltage as well. Remember that the closer the capacitor voltage is to the target voltage, the slower it charges. So the charging will start to slow down as it approaches the cutoff.</p>

<p><span class="num-circle">2</span> What if the capacitor were trying to charge up to a voltage <em>way</em> above the cutoff, say $10^6\text{ V}$? Well assuming your breadboard doesn&rsquo;t melt, the capacitor would reach the cutoff pretty quick. Why? Well the fastest part of the charging is when you&rsquo;re really far from the target voltage, and $3.33\text{ V}$ is pretty damn far from $10^6\text{ V}$!</p>

<p>You should kinda be able to interpolate what happens in between these two cases. Note that all of what I&rsquo;ve just said applies to the discharging phase too.</p>

<p>A graph might be helpful here (after all, a picture is worth a thousand words). The x-axis represents time and the y-axis represents voltage. The blue curve is the voltage of $C_1$ during the charging phase while the red curve is the voltage of $C_1$ during the discharging phase. The purple dotted lines are the target voltages, and the black lines are the high/low cutoff voltages.</p>

<p><img src="/images/555-R1/capacitor_graph.png#c" height="350px"/>
<div class="figure-caption">The discharge phase takes longer than the charging phase because the low cutoff voltage is closer to the discharging target voltage</div></p>

<p>Notice how the discharge target voltage is <em>really close</em> to the low cutoff voltage, so the discharge curve flattens out as it approaches the low cutoff voltage, slowing down, causing it to take longer.</p>

<p>Ok, so we have our intuition, but let&rsquo;s crunch some numbers.</p>

<p>First up, <strong>how far is the charging target voltage from the high cutoff voltage?</strong> The high cutoff voltage is ${2}/{3}\ V_{CC}$, and the capacitor is trying to charge up to $V_{CC}$. So the gap is ${1}/{3}\ V_{CC}\approx$<span class="highlight">$1.67\text{ V}$</span></p>

<p>Up next, <strong>how far is the discharging target voltage from the low cutoff voltage?</strong> The low cutoff voltage is ${1}/{3}\ V_{CC}$. The voltage the capacitor is trying to discharge down to is given by</p>

<p>$$ \frac{R_2}{R_1+R_2} \times V_{CC} = \frac{1\text{ MΩ}}{3\text{ MΩ}+1\text{ MΩ}} \times V_{CC} = {1}/{4}V_{CC} $$</p>

<p>Thus, the gap is ${1}/{12}\ V_{CC}\approx$<span class="highlight">$0.42\text{ V}$</span></p>

<p>To fix the issue, we want the charging and discharging phases to behave about the same, which means we need these gaps to be about the same.</p>

<h1 id="a-naive-fix">A Naive Fix</h1>

<p>By this logic, the solution then is to move the discharge target voltage to be as close to $0\text{ V}$ as we can. That way the distance between the low cutoff voltage and the discharge target voltage will <em>also</em> be ${1}/{3}\ V_{CC}$.</p>

<p>The discharge target voltage is given by the voltage divider mentioned just a bit ago. To make the formula go to $0\text{ V}$, we can have $R_1$ go to $\infty\text{ Ω}$.</p>

<p>Of course, $\infty\text{ Ω}$ is not a resistor value that I have in my box, but basically we just need to make $R_1$ <em>really, really</em> big.</p>

<p>Here&rsquo;s a GIF (or GIF if you prefer that pronounciation) showing how increasing the value of $R_1$ makes the waveform look more like the waveform we want.</p>

<p><img src="/images/555-R1/converge.gif#c" height="400px"/>
<div class="figure-caption">Simulating various values of $R_1$</div></p>

<p>One thing that should really pop out from the GIF is that $R_1$ doesn&rsquo;t just affect the duty cycle of the wave, <em>it affects the frequency too</em>. So it looks like having a large $R_1$ is doubly important to meeting the specifications.</p>

<h1 id="a-better-fix">A Better Fix</h1>

<p>Based on the simulations, having $R_1 = 50\text{ MΩ}$ would be enough to get a good-looking wave. Of course, that&rsquo;s way too high a value to practically use in the circuit; I don&rsquo;t exactly have that sitting in my kit...</p>

<p>Fortunately, there is another solution. Recall once again that the discharging target voltage is determined by a very familiar formula:</p>

<p>$$ \frac{R_2}{R_1+R_2} \times V_{CC} $$</p>

<p>I&rsquo;m sure you&rsquo;ve probably seen it too many times by now, but I really hate having to scroll all the way back because an equation is referenced by number.</p>

<p>Anyways, we need to make the whole thing evaluate to $\sim 0\text{ V}$, and we originally thought to do that by taking $R_1$ to be a really large value. But really, all we need is for the denominator to be much larger than the numerator.</p>

<p>Now, the numerator contains <em>only</em> $R_2$, and $R_1$ is <em>only</em> in the denominator. So, it would make sense that all we need is for $R_1 &gt;&gt; R_2$. So if the value of $R_2$ is small, we get some more breathing room for the value of $R_1$.</p>

<p>To show this, I&rsquo;ve graphed the equation ${R_2}\,/\,{(R_1+R_2)}=k$ for various values of $k$. The discharging target voltage is given by $k\times V_{CC}$, so we want $k\approx 0$.</p>

<p>As an example, let&rsquo;s look at the red line. Every point on that line represents a combination of values of $R_1$ and $R_2$ that will give us $k=0.02$. If we pick a point with a lower value for $R_2$, we naturally end up with a lower value for $R_1$. This is true no matter what line (i.e. value of $k$) we look at.</p>

<p><img src="/images/555-R1/vdiv_varied.png#c" height="450px"/>
<div class="figure-caption">$R_1$ and $R_2$ are directly proportional</div></p>

<p>I should add that if you change $R_2$, you also need to change $C_1$ appropriately to keep the frequency of the circuit the same.</p>

<p>To prove that this will work, here is an updated circuit where $R_2$ has been greatly lowered, $C_1$ has been adjusted as necessary, and $R_1$ is kept at $3\text{ MΩ}$:</p>

<p><img src="/images/555-R1/schematic_ideal.png#c" height="350px"/>
<div class="figure-caption">A more ideal circuit, built using more convenient values of $R_1$ and $R_2$. The changed values are boxed in red</div></p>

<p>And here is the corresponding simulation run:</p>

<p><img src="/images/555-R1/graph_ideal.png#c" height="450px"/>
<div class="figure-caption">The &ldquo;perfect&rdquo; waveform created using more convenient values of $R_1$ and $R_2$</div></p>

<p>&nbsp;</p>

<p>Now <em>that&rsquo;s</em> what I call a waveform!</p>

<h1 id="conclusion">Conclusion</h1>

<p>&ldquo;Sufficiently high enough&rdquo; means much, much bigger than the other resistor. So don&rsquo;t use too large of an $R_2$ or you&rsquo;re gonna have to have an absolute unit for an $R_1$.</p>

    </div>
  </div>
</section>
<section class="section">
  <div class="container has-text-centered">
    <p>&copy; <a href="https://www.github.com/rchoudhary">Rutvik Choudhary</a> 2019</p>
    <p>Powered by <a href="https://gohugo.io/">Hugo</a> &amp; <a href="https://github.com/ribice/kiss">Kiss</a>.</p>
  </div>
</section>


</body>
</html>

