<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"  lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <script type="text/javascript" src="/js/custom.js"></script>
  
    <title>Debugging a 555 Circuit | Null Pointers</title>
  
  <meta property='og:title' content='Debugging a 555 Circuit - Null Pointers'>
<meta property='og:description' content='While building a 555 astable timer circuit, I noticed that the value of a seemingly unrelated resistor was actually of crucial importance to the overall functionality. Using simple circuit analysis and simulation, I got to the bottom of why exactly this resistor matters: it controls the asymptotic behavior of a timing capacitor.'>
<meta property='og:url' content='https://rchoudhary.github.io/555-r1/'>
<meta property='og:site_name' content='Null Pointers'>
<meta property='og:type' content='article'><meta property='og:image' content='https://rchoudhary.github.io/images/555-R1/schematic.png'><meta property='article:published_time' content='2020-01-06T00:00:00-06:00'/><meta property='article:modified_time' content='2020-01-06T00:00:00-06:00'/><meta name='twitter:card' content='summary'><meta name='twitter:site' content='@'><meta name='twitter:creator' content='@'>
  
  <link rel="stylesheet" href="/css/style.css"/><link rel='stylesheet' href='https://rchoudhary.github.io/css/custom.css'><link rel="preload" href="/logo.png" as="image">
  <link rel="preload" href="/logo_dark.png" as="image">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
  <link href="https://fonts.googleapis.com/css?family=Roboto+Mono|Source Code Pro|Source+Code+Pro|Open+Sans&display=swap" rel="stylesheet">
  <link href='https://fonts.googleapis.com/css?family=Roboto:400,100,300,100italic,300italic,400italic,500italic,500,700,700italic,900,900italic' rel='stylesheet' type='text/css'>
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  </script>
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
    });
  </script>
</head>
<body style="display: block">
<section class="section">
  <div class="container">
    <nav class="nav">
      <div class="nav-left">
        <a class="nav-item" id="site-title" href="https://rchoudhary.github.io">
            <h1>Null Pointers</h1>
        </a>
      </div>
      <div class="nav-right">
        <nav class="nav-item level is-mobile"><a class="level-item" aria-label="github" href='https://github.com/rchoudhary' target='_blank' rel='noopener'>
              <span class="icon">
                <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/>
    
  </svg></i>
              </span>
            </a></nav>
      </div>
    </nav>

    

  </div>
</section>

<section class="section">
  <div class="container">
    <div class="subtitle tags is-6 is-pulled-right">
      
    </div>
    
      <h2 class="subtitle is-6">Jan 6, 2020</h2>
    
    <h1 class="title">Debugging a 555 Circuit</h1>
    
    <div class="content" id="content">
      <h1 id="summary">Summary</h1>
      <p>While building a 555 astable timer circuit, I noticed that the value of a seemingly unrelated resistor was actually of crucial importance to the overall functionality. Using simple circuit analysis and simulation, I got to the bottom of why exactly this resistor matters: it controls the asymptotic behavior of a timing capacitor.</p>
      <h1 id="toc">Table of Contents</h1>
      <nav id="TableOfContents"></nav>
      <h1 id="the-setup">The Setup</h1>
<p>I bought some 555 timers and figured I would make an LED blink. I decided a frequency of $2\text{ Hz}$ was a good target. I wanted a duty cycle of $50\%$ because to me that's most visually appealing.</p>
<p>According to <a href="https://www.electronics-tutorials.ws/waveforms/555_oscillator.html">this tutorial</a>, all I needed to do was build this circuit:</p>
<figure>
    <img src="/images/555-R1/555-circuit_padded.png#c"
         alt="555 50% duty cycle oscillator circuit"/> <figcaption>
            <p>Reference: Electronics Tutorials</p>
        </figcaption>
</figure>

<p>To get any particular frequency $f$, I simply needed to utilize the formula</p>
<p>$$ f=\frac{1}{0.693(2R_2)C_1}\,\text{ Hz} $$</p>
<p>Using my impeccable algebra skills, I figured out that to get a $2 \text{ Hz}$ wave I needed</p>
<p>$$ R_2C_1 \approx 0.360$$</p>
<p>I looked through my electronics parts to see what values capacitors and resistors I had:</p>
<figure>
    <img src="/images/555-R1/res_values_padded.png#c"
         alt="available resistor values"/> 
</figure>

<figure>
    <img src="/images/555-R1/cap_values.png#c"
         alt="available capacitor values"/> <figcaption>
            <p>Can you spot the manufacturer's typo in the capacitor values?</p>
        </figcaption>
</figure>

<p>Just from eyeballing it, a $330\text{ nF}$ capacitor and a $1\text{ MΩ}$ resistor would do the trick. In fact, if we plug in those values, we get $f \approx 2.186\text{ Hz}$. Good enough!</p>
<p>For $C_2$, I didn't have a $0.01\text{ µF}$ capacitor, but I did have a $0.1\text{ µF}$ capacitor. Since $C_2$ is just there to stabilize the voltage on the <code>CONTROL</code> pin, that was also good enough.</p>
<p>The question now was what to do about $R_1$. How big or small should it be? The tutorial doesn't say much:</p>
<blockquote>
<p>Note that resistor R1 needs to be sufficiently high enough to ensure it does not interfere with the charging of the capacitor to produce the required 50% duty cycle</p>
</blockquote>
<p>Is $100\text{ kΩ}$ &ldquo;sufficiently high enough?&rdquo; It seemed pretty big to me, and I mean that's what the picture used anyways. I went ahead built the circuit to test it out:</p>
<figure>
    <img src="/images/555-R1/555_100k.jpg#c"
         alt="555 astable circuit using 100 kilo ohms for R1"/> 
</figure>

<p>I powered it up, but whenever I turned the circuit on, the LED would flash briefly and then never turn on again. This would happen every time I connected the circuit to power:</p>
<figure>
    <img src="/images/555-R1/555_100k_animation.gif#c"
         alt="Demonstration of 555 astable circuit using 100 kilo ohms for R1"/> <figcaption>
            <p>I mean, I guess I could create a $2\text{ Hz}$ wave by just plugging and unplugging the power manually</p>
        </figcaption>
</figure>

<p>I double- and triple-checked the wiring, but couldn't find anything wrong :(</p>
<p>I figured just mindlessly quadruple-checking was gonna be useless. It was time for some good ol&rsquo; circuit analysis!</p>
<h1 id="background-reading">Background Reading</h1>
<p>I'm gonna offload the work of explaining how the astable configuration of a 555 works to this person's video. The relevant part starts at 6:54 (maybe watch at 1.5x speed).</p>

<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://www.youtube.com/embed/i0SNb__dkYI" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>

<h1 id="debugging-the-circuit">Debugging the Circuit</h1>
<p>Unfortunately, I didn't have an oscilloscope lying around (on account of them being expensive), so I settled for simulation using <a href="http://www.analog.com/en/design-center/design-tools-and-calculators/ltspice-simulator.html">LTSpice</a> (which is free).</p>
<p>In LTSpice I created the schematic for my circuit:</p>
<figure>
    <img src="/images/555-R1/schematic.png#c"
         alt="Schematic of 555 astable circuit using 100 kilo ohms for R1"/> 
</figure>

<p>I then simulated it and got the following results. The blue line is the voltage at the <code>OUT</code> pin and the green line is the voltage across the capacitor, i.e. the voltage at the <code>THRESHOLD</code> pin.</p>
<figure>
    <img src="/images/555-R1/graph_100k.png#c"
         alt="Simulation of 555 astable circuit using 100 kilo ohms for R1"/> <figcaption>
            <p>The <code>OUT</code> pin goes high for just a bit then turns off, never to turn on again</p>
        </figcaption>
</figure>

<p>After close inspection, I was curious as to why the capacitor topped out at $4.5\text{ V}$. After all, it's connected to the $5\text{ V}$ supply, so it should asymptotically approach $5\text{ V}$ right?</p>
<p>The trick was to think of the circuit like this:</p>
<figure>
    <img src="/images/555-R1/C1_circuit.png#c"
         alt="Circuit redrawn to put focus on C1"/> <figcaption>
            <p>I like to hand draw my circuit diagrams &lsquo;cause I think it adds a certain charm</p>
        </figcaption>
</figure>

<p>If there's one thing my undergrad degree taught me, it's recognizing <strong>voltage dividers</strong>, and boy howdy, $R_1$ and $R_2$ sure look like one! From there it was fairly straightforward to see what the issue was:</p>
<p><span class="num-circle">1</span>$C_1$ starts out discharged and so the <code>THRESHOLD</code> pin is low. This causes <code>OUT</code> to start out high.</p>
<p><span class="num-circle">2</span>$C_1$ charges up through both resistors.</p>
<figure>
    <img src="/images/555-R1/C1_charging_padded.png#c"
         alt="C1 charging up through R1 and R2"/> 
</figure>

<p><span class="num-circle">3</span>$C_1$ evenutally brings <code>THRESHOLD</code> up to ${2}/{3}\,V_{CC}$, and so the <code>OUT</code> pin goes low.</p>
<p><span class="num-circle">4</span><code>OUT</code> now acts as a ground, so $R_1$ and $R_2$ form a voltage divider. Since $C_1$ is connected to the output of the voltage divider, it will charge up to the value of the divider.</p>
<figure>
    <img src="/images/555-R1/C1_volt_div_padded.png#c"
         alt="R1 and R2 forming a voltage divider that determines what voltage C1 charges to"/> 
</figure>

<p>We can easily calculate what the steady-state voltage of $C_1$ will be:
$$ \left(\frac{R_2}{R_1+R_2}\right) V_{CC} = \left(\frac{10^6Ω}{10^3Ω+10^6Ω}\right)\left(5\text{ V}\right)\approx 4.545 \text{ V} $$
That explains why $C_1$ stabilizes at roughly $4.5\text{ V}$</p>
<p><span class="num-circle">5</span>Now nothing will change. In order for the <code>OUT</code> pin to toggle, the <code>THRESHOLD</code> pin needs to reach ${1}/{3}\,V_{CC}$. Unfortunately, the voltage divider keeps $C_1$ at $4.5\text{ V}$.</p>
<h1 id="a-first-attempt-at-a-fix">A First Attempt at a Fix</h1>
<p>Ok, so we just need to pick a value of $R_1$ such that $C_1$ stabilizes at a voltage below ${1}/{3}\,V_{CC}$. Mathematically, this means we need</p>
<p>$$ \left(\frac{R_2}{R_1+R_2}\right) V_{CC} &lt; \frac{1}{3}\,V_{CC} $$</p>
<p>A little bit of algebra gives us our constraint: <span class="hl">in order for the circuit to oscillate, we need $R_1&gt;2\,R_2 $</span></p>
<p>Since in our circuit $R_2=1\text{ MΩ}$, a nice choice for $R_1$ would be $3\text{ MΩ}$. I used this new value of $R_1$ in my circuit and tested it out:</p>
<figure>
    <img src="/images/555-R1/555_3M_animation.gif#c"
         alt="Demonstration of 555 astable circuit using 3 mega ohms for R1"/> <figcaption>
            <p>The duty cycle doesn't seem quite right&hellip;</p>
        </figcaption>
</figure>

<p>Eh&hellip; I mean it's a $2\text{-ish Hz}$ wave (I checked by timing it with a stopwatch), but the pulsing doesn't look symmetric&hellip;</p>
<p>To confirm my suspicion, I simulated the circuit with $R_1=3\text{ MΩ}$ and got the following graph:</p>
<figure>
    <img src="/images/555-R1/graph_3m.png#c"
         alt="Simulation of 555 astable circuit using 3 mega ohms for R1"/> <figcaption>
            <p>Simulation shows the capacitor waveform (green) is asymmetric</p>
        </figcaption>
</figure>

<p>Well, that most certainly is <strong>not</strong> a $50\%$ duty cycle! It seems that $C_1$ spends more time discharging than it does charging&hellip;</p>
<h1 id="why-is-charging-quicker-than-discharging">Why Is Charging Quicker Than Discharging?</h1>
<p>By the laws of physics, a capacitor charges/discharges up to its target voltage <strong>asymptotically</strong>. So not only will the capacitor voltage never quite reach the target voltage, but it will actually charge/discharge <strong>slower</strong> the closer it gets.</p>
<p>Thus if the asymptote is just past the cutoff voltage, the capacitor will start to slow down its charging/discharging as it approaches the cutoff. Of course, since the cutoff is before the asymptote, it is guaranteed to reach the cutoff; it just will take a relatively longer time.</p>
<p>On the other hand, if the asymptote were way past the cutoff, the capacitor would reach the cutoff pretty quickly. This is because as the capacitor voltage approaches the cutoff, it's still quite far from the asymptote, so it slows down negligibly.</p>
<p>Let's see this visually! We'll take a capacitor that is <em>charging</em> from $1\text{ V}\rightarrow 6\text{ V}$ but is cut off at $2\text{ V}$, meaning there is a gap of a whopping $4\text{ V}$. We'll also take a separate capacitor that is <em>discharging</em> from $2\text{ V}\rightarrow 0.97\text{ V}$ but is cut off at $1\text{ V}$, meaning there is a gap of merely $0.03\text{ V}$. We'll start both capacitors at $t=0$.</p>
<p>I've put time on the x-axis and voltage on the y-axis. The green curve represents the charging while the blue curve represents the discharging. The orange dotted lines indicate the asymptotes while the black lines indicate the cutoffs. The little X's show where the capacitors hit their cutoffs.</p>
<figure>
    <img src="/images/555-R1/capacitor_graph.png#c"
         alt="Graph showing the asymmetry between the charging and discharging phases"/> <figcaption>
            <p>A visual example of how target voltage placement can affect the duration of charging/discharging. You can play with it yourself <a href="https://www.desmos.com/calculator/awionttumo">here</a> (hopefully that link doesn't break&hellip;)</p>
        </figcaption>
</figure>

<p>From the graph it's pretty easy to see why green &ldquo;wins&rdquo;. The asymptote is so far from the cutoff that the charging basically plows straight through the cutoff. On the other hand, the asymptote for blue is right under the cutoff, so it heavily slows down as it approaches the cutoff, making discharging take its sweet time.</p>
<hr>
<p><strong>IMPORTANT NOTE:</strong> If you're going to look at the gaps between the cutoffs and the asymptotes to see who wins, it's important that the gaps between the starting voltages and the cutoffs be the same!</p>
<p>In the case of the previous graph, the gaps between the starting voltages and the cutoffs were both $1\text{ V}$, so we're good there.</p>
<hr>
<p>Let's crunch some numbers to get a sense of how our circuit fares.</p>
<p>First up, <strong>how big is the gap between the charging asymptote and the high cutoff voltage?</strong> The high cutoff voltage is ${2}/{3}\,V_{CC}$, and the capacitor is trying to charge up to $V_{CC}$. So the gap is ${1}/{3}\,V_{CC}\approx 1.67\text{ V}$</p>
<p>Up next, <strong>how big is the gap between the discharging asymptote and the low cutoff voltage?</strong> The low cutoff voltage is ${1}/{3}\,V_{CC}$. The voltage that the capacitor is trying to discharge down to is given by</p>
<p>$$ \left(\frac{R_2}{R_1+R_2}\right) V_{CC} = \left(\frac{1\text{ MΩ}}{3\text{ MΩ}+1\text{ MΩ}}\right) V_{CC} = \frac{1}{4}\,V_{CC} $$</p>
<p>Thus, the gap is ${1}/{12}\,V_{CC}\approx 0.42\text{ V}$</p>
<p>Since the gap between charging asymptote and the high cutoff voltage is <strong>bigger</strong> than the gap between the discharging asymptote and the low cutoff voltage, charging is <strong>faster</strong>.</p>
<p>Note that the gaps between the starting voltages and the cutoffs are both ${1}/{3}\,V_{CC}$, so this comparison/conclusion is valid.</p>
<h1 id="the-fix">The Fix</h1>
<p>The obvious solution is to move the discharge asymptote to be as close to $0\text{ V}$ as we can. That way the gap between the low cutoff voltage and the discharge asymptote will <em>also</em> be ${1}/{3}\,V_{CC}$.</p>
<p>The discharge asymptote is given by the voltage divider mentioned just a bit ago. To make the formula go to $0\text{ V}$, we can have $R_1$ go to $\infty\text{ Ω}$.</p>
<p>Of course, $\infty\text{ Ω}$ is not a resistor value that I have in my box, but the gist is that <span class="hl">we need to make $R_1$ <em>really, really</em> big</span>.</p>
<p>Here's a GIF showing how increasing the value of $R_1$ makes the waveform look more like what we want.</p>
<figure>
    <img src="/images/555-R1/converge.gif#c"
         alt="Animation showing how increasing the value of R1 improves the waveform"/> <figcaption>
            <p>Simulating various values of $R_1$</p>
        </figcaption>
</figure>

<p>One thing that should really pop out from the GIF is that <span class="hl">$R_1$ doesn't just affect the duty cycle of the wave, <strong>it affects the frequency too</strong></span>. So having a large $R_1$ is <em>doubly</em> important to meeting the specifications!</p>
<p>Looks like having $R_1 = 50\text{ MΩ}$ would give us a good-looking wave.</p>
<h1 id="another-fix">Another Fix</h1>
<p>One small problem: I don't have a $50\text{ MΩ}$ resistor sitting in my kit&hellip;</p>
<p>Fortunately, there is something <em>else</em> we can do!</p>
<p>Recall (yet again) that the discharging asymptote for the capacitor is determined by the expression:</p>
<p>$$ \left(\frac{R_2}{R_1+R_2}\right) V_{CC} $$</p>
<p>We need that whole expression to be $\sim 0\text{ V}$, and we originally thought to do that by taking $R_1$ to be a really large value.</p>
<p>But we can use a bit of algebra to instead write it like this:</p>
<p>$$ \left(\frac{1}{1+\frac{R_1}{R_2}}\right) V_{CC} $$</p>
<p>If we want to make the expression approach $0\text{ V}$, we need to make ${R_1}/{R_2}$ approach $\infty$. To that end, we can either make $R_1$ approach $\infty\text{ Ω}$ as we did earlier, <strong>OR</strong> we can instead make $R_2$ approach $0\text{ Ω}$</p>
<p>So <span class="hl">rather than <em>increasing</em> $R_1$, we can instead <em>decrease</em> $R_2$ to get the same effect!</span></p>
<p>Of course, remember that $R_2$ and $C_1$ together control the timing of the oscillator by the formula</p>
<p>$$ f=\frac{1}{0.693(2R_2)C_1}\,\text{ Hz} $$</p>
<p>We can clearly see that to keep $f$ the same, we need to keep $R_2C_1$ the same. So if we <em>decrease</em> $R_2$ by some factor, we just need to <em>increase</em> $C_1$ by that <em>same</em> factor.</p>
<h1 id="the-final-circuit">The Final Circuit</h1>
<p>Ok, let's try to make a better waveform <em>without</em> changing $R_1$</p>
<p>Here is an updated circuit where the value of $R_2$ has been <em>reduced</em> by a factor of $10$, the value of $C_1$ has been <em>increased</em> by a factor of $10$ (remember, this is so that the timing stays the same), and the value of $R_1$ has been <em>kept</em> at $3\text{ MΩ}$:</p>
<figure>
    <img src="/images/555-R1/schematic_ideal.png#c"
         alt="Schematic of an ideal 555 50% duty cycle oscillator circuit"/> <figcaption>
            <p>A more ideal circuit, built using more convenient values of $R_1$ and $R_2$. The changed values are boxed in red</p>
        </figcaption>
</figure>

<p>So now $R_1$ is a factor of $30$ greater than $R_2$. Here is the corresponding simulation run:</p>
<figure>
    <img src="/images/555-R1/graph_ideal.png#c"
         alt="Simulation of an ideal 555 50% duty cycle oscillator circuit"/> <figcaption>
            <p>The &ldquo;perfect&rdquo; waveform created using more convenient values of $R_1$ and $R_2$</p>
        </figcaption>
</figure>

<p>Now <em>that's</em> what I'm talking about!</p>
<h1 id="conclusion">Conclusion</h1>
<p>The Electronics Tutorial article gave this advice for choosing $R_1$:</p>
<blockquote>
<p>Note that resistor R1 needs to be sufficiently high enough to ensure it does not interfere with the charging of the capacitor to produce the required 50% duty cycle</p>
</blockquote>
<p>Now we know what &ldquo;sufficiently high enough&rdquo; means:</p>
<p><span class="num-circle">1</span> First and foremost, we need $R_1 &gt; 2\,R_2$ so that the 555 circuit actually oscillates.</p>
<p><span class="num-circle">2</span> To actually get the $50\%$ duty cycle <strong>and</strong> to make sure we get the frequency we want, we need $R_1$ to be <em>much</em> bigger than $R_2$. We saw in the last section that a factor of $30$ seems to work.</p>
<p>As a rule of thumb, it helps to use a relatively small value of $R_2$ so that you don't need a humongous $R_1$.</p>

    </div>
  </div>
</section>
<footer class="section">
  <div class="container has-text-centered">
    <p>&copy; <a href="https://www.github.com/rchoudhary">Rutvik Choudhary</a> 2020</p>
    <p>Powered by <a href="https://gohugo.io/">Hugo</a> &amp; <a href="https://github.com/ribice/kiss">Kiss</a>.</p>
  </div>
</footer>


</body>
</html>

