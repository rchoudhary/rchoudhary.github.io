<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"  lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <script type="text/javascript" src="/js/custom.js"></script>
  
    <title>Debugging a 555 Circuit | Null Pointers</title>
  
  
  
  <link rel="stylesheet" href="/css/style.css"/><link rel='stylesheet' href='https://rchoudhary.github.io/css/custom.css'><link rel="preload" href="/logo.png" as="image">
  <link rel="preload" href="/logo_dark.png" as="image">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
  <link href="https://fonts.googleapis.com/css?family=Roboto+Mono|Source Code Pro|Source+Code+Pro&display=swap" rel="stylesheet">
  <link href='http://fonts.googleapis.com/css?family=Roboto:400,100,300,100italic,300italic,400italic,500italic,500,700,700italic,900,900italic' rel='stylesheet' type='text/css'>
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  </script>
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
    });
  </script>
</head>
<body style="display: block">
<section class="section">
  <div class="container">
    <nav class="nav">
      <div class="nav-left">
        <a class="nav-item" id="site-title" href="https://rchoudhary.github.io">
            <h1>Null Pointers</h1>
        </a>
      </div>
      <div class="nav-right">
        <nav class="nav-item level is-mobile"><a class="level-item" aria-label="github" href='https://github.com/rchoudhary' target='_blank' rel='noopener'>
              <span class="icon">
                <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/>
    
  </svg></i>
              </span>
            </a></nav>
      </div>
    </nav>

    

  </div>
</section>

<section class="section">
  <div class="container">
    <div class="subtitle tags is-6 is-pulled-right">
      
    </div>
    
      <h2 class="subtitle is-6">Dec 24, 2019</h2>
    
    <h1 class="title">Debugging a 555 Circuit</h1>
    
    <div class="content" id="content">
      <h1 id="summary">Summary</h1>
      <p>While building a 555 astable timer circuit, I noticed that the value of a seemingly unrelated resistor was actually of crucial importance to the overall functionality. Using simple circuit analysis and simulation, I got to the bottom of why exactly this resistor matters.</p>
      <h1 id="toc">Table of Contents</h1>
      <nav id="TableOfContents">
<ul>
<li><a href="#the-setup">The Setup</a></li>
<li><a href="#background-reading">Background Reading</a></li>
<li><a href="#debugging-the-circuit">Debugging the Circuit</a></li>
<li><a href="#a-first-attempt-at-a-fix">A First Attempt at a Fix</a></li>
<li><a href="#why-is-charging-quicker-than-discharging">Why Is Charging Quicker Than Discharging?</a></li>
<li><a href="#the-fix">The Fix</a></li>
<li><a href="#another-fix">Another Fix</a></li>
<li><a href="#the-final-circuit">The Final Circuit</a></li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
</nav>
      

<h1 id="the-setup">The Setup</h1>

<p>I bought some 555 timers and figured I would make an LED blink. I chose a frequency of $2\text{ Hz}$ just because and a duty cycle of $50\%$ because to me that&rsquo;s most visually appealing.</p>

<p>According to <a href="https://www.electronics-tutorials.ws/waveforms/555_oscillator.html">this tutorial</a>, all I needed to do was build this circuit:</p>

<p><img src="/images/555-R1/555-circuit_padded.png#c" alt="555 50% duty cycle oscillator circuit" /></p>

<div class="figure-caption">Reference: <a href="https://www.electronics-tutorials.ws/waveforms/555_oscillator.html">Electronics Tutorials</a></div>

<p>&nbsp;</p>

<p>To get any particular frequency $f$, I simply needed to utilize the formula</p>

<p>$$ f=\frac{1}{0.693(2R_2)C_1}\,\text{ Hz} $$</p>

<p>Using my impeccable algebra skills, I figured out that to get a $2 \text{ Hz}$ wave I needed</p>

<p>$$ R_2C_1 \approx 0.360$$</p>

<p>I looked through my electronics parts to see what values capacitors and resistors I had:</p>

<p><img src="/images/555-R1/res_values_padded.png#c" alt="available resistor values" />
<img src="/images/555-R1/cap_values.png#c" alt="available capacitor values" />
<div class="figure-caption">Can you spot the manufacturer&rsquo;s typo in the capacitor values?</div></p>

<p>Just from eyeballing it, a $330\text{ nF}$ capacitor and a $1\text{ MΩ}$ resistor would do the trick. In fact, if we plug in those values, we get $f \approx 2.186\text{ Hz}$. Good enough!</p>

<p>For $C_2$, I didn&rsquo;t have a $0.01\text{ µF}$ capacitor, but I did have a $0.1\text{ µF}$ capacitor. $C_2$ is just there to stabilize the voltage on the <code>CONTROL</code> pin, so also good enough!</p>

<p>The question now was what to do about $R_1$. How big or small should it be? The tutorial doesn&rsquo;t say much:</p>

<blockquote>
<p>Note that resistor R1 needs to be sufficiently high enough to ensure it does not interfere with the charging of the capacitor to produce the required 50% duty cycle</p>
</blockquote>

<p>Is $100\text{ kΩ}$ &ldquo;sufficiently high enough?&rdquo; It seemed pretty big to me, and I mean that&rsquo;s what the picture used anyways. I went ahead built the circuit to test it out:</p>

<p><img src="/images/555-R1/555_100k.jpg#c" alt="555 astable circuit using 100 kilo ohms for R1" /></p>

<p>I powered it up, but whenever I turned the circuit on, the LED would flash briefly and then never turn on again. This would happen every time I connected the circuit to power:</p>

<p><img src="/images/555-R1/555_100k_animation.gif#c" alt="demonstration of 555 astable circuit using 100 kilo ohms for R1" />
<div class="figure-caption">I suppose I could create a $2\text{ Hz}$ wave by just plugging and unplugging the power manually</div></p>

<p>I double- and triple-checked the wiring, but couldn&rsquo;t find anything wrong! I figured just mindlessly quadruple-checking was gonna be useless. I needed to Get Smart™️</p>

<h1 id="background-reading">Background Reading</h1>

<p>I&rsquo;m gonna offload the work of explaining how the astable configuration of a 555 works to this person&rsquo;s video. The relevant part starts at 6:54 (maybe watch at 1.5x speed).</p>

<div style="width: 100%;">
    <div style="width: 75%; margin-left:auto; margin-right:auto">
        <div class="video-wrapper" style="text-align: center;">
            <iframe src="https://www.youtube.com/embed/i0SNb__dkYI?rel=0&amp;start=414" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
        </div>
    </div>
</div>

<h1 id="debugging-the-circuit">Debugging the Circuit</h1>

<p>Unfortunately, I didn&rsquo;t have an oscilloscope lying around (on account of them being expensive), so I settled for simulation using <a href="http://www.analog.com/en/design-center/design-tools-and-calculators/ltspice-simulator.html">LTSpice</a> (which is free).</p>

<p>In LTSpice I created the schematic for my circuit:</p>

<p><img src="/images/555-R1/schematic.png#c" alt="schematic of 555 astable circuit using 100 kilo ohms for R1" /></p>

<p>I then simulated it and got the following results. The blue line is the voltage at the <code>OUT</code> pin and the green line is the voltage across the capacitor, i.e. the voltage at the <code>THRESHOLD</code> pin.</p>

<p><img src="/images/555-R1/graph_100k.png#c" alt="simulation of 555 astable circuit using 100 kilo ohms for R1" />
<div class="figure-caption">The <code>OUT</code> pin goes high for just a bit then turns off, never to turn on again</div></p>

<p>After close inspection, I was curious as to why the capacitor topped out at $4.5\text{ V}$. After all, it&rsquo;s connected to the $5\text{ V}$ supply, so it should asymptotically approach $5\text{ V}$ right?</p>

<p>The trick was to think of the circuit like this:</p>

<p><img src="/images/555-R1/C1_circuit.png#c" alt="circuit redrawn to put focus on C1" />
<div class="figure-caption">I like to hand draw my circuit diagrams &lsquo;cause I think it adds a certain charm</div></p>

<p>If there&rsquo;s one thing my undergrad degree taught me, it&rsquo;s recognizing <strong>voltage dividers</strong>, and boy howdy, $R_1$ and $R_2$ sure look like one! From there it was fairly straightforward to see what the issue was:</p>

<p><span class="num-circle">1</span>$C_1$ starts out discharged and so the <code>THRESHOLD</code> pin is low. This causes <code>OUT</code> to start out high.</p>

<p><span class="num-circle">2</span>$C_1$ charges up through both resistors.</p>

<p><img src="/images/555-R1/C1_charging_padded.png#c" alt="C1 charging up through R1 and R2" /></p>

<p><span class="num-circle">3</span>$C_1$ evenutally brings <code>THRESHOLD</code> up to ${2}/{3}\ V_{CC}$, and so the <code>OUT</code> pin goes low.</p>

<p><span class="num-circle">4</span><code>OUT</code> now acts as a ground, so $R_1$ and $R_2$ form a voltage divider. Since $C_1$ is connected to the output of the voltage divider, it will charge up to the value of the divider.</p>

<p><img src="/images/555-R1/C1_volt_div_padded.png#c" alt="R1 and R2 forming a voltage divider that determines what voltage C1 charges to" /></p>

<p>We can easily calculate what the steady-state voltage of $C_1$ will be:
$$ \left(\frac{R_2}{R_1+R_2}\right) V_{CC} = \left(\frac{10^6Ω}{10^3Ω+10^6Ω}\right)\left(5\text{ V}\right)\approx 4.545 \text{ V} $$
That explains why $C_1$ stabilizes at roughly $4.5\text{ V}$</p>

<p><span class="num-circle">5</span>Now nothing will change. In order for the <code>OUT</code> pin to toggle, the <code>THRESHOLD</code> pin needs to reach ${1}/{3}\ V_{CC}$. Unfortunately, the voltage divider keeps $C_1$ at $4.5\text{ V}$.</p>

<h1 id="a-first-attempt-at-a-fix">A First Attempt at a Fix</h1>

<p>Ok, so we just need to pick a value of $R_1$ such that $C_1$ stabilizes at a voltage below ${1}/{3}\ V_{CC}$. Mathematically, this means we need</p>

<p>$$ \left(\frac{R_2}{R_1+R_2}\right) V_{CC} &lt; \frac{1}{3}\ V_{CC} $$</p>

<p>A little bit of algebra gives us our constraint: <span class="highlight">in order for the circuit to oscillate, we need $R_1&gt;2\,R_2 $</span></p>

<p>Since in our circuit $R_2=1\text{ MΩ}$, a nice choice for $R_1$ would be $3\text{ MΩ}$. I used this new value of $R_1$ in my circuit and tested it out:</p>

<p><img src="/images/555-R1/555_3M_animation.gif#c" alt="demonstration of 555 astable circuit using 3 mega ohms for R1" />
<div class="figure-caption">The duty cycle doesn&rsquo;t seem quite right...</div></p>

<p>Eh... I mean it&rsquo;s a $2\text{-ish Hz}$ wave (I checked by timing it with a stopwatch), but the pulsing doesn&rsquo;t look symmetric...</p>

<p>To confirm my suspicion, I simulated the circuit with $R_1=3\text{ MΩ}$ and got the following graph:</p>

<p><img src="/images/555-R1/graph_3m.png#c" alt="simulation of 555 astable circuit using 3 mega ohms for R1" />
<div class="figure-caption">Simulation shows the capacitor waveform (green) is asymmetric</div></p>

<p>Well, that most certainly is <strong>not</strong> a 50% duty cycle! It seems that $C_1$ spends more time discharging than it does charging...</p>

<h1 id="why-is-charging-quicker-than-discharging">Why Is Charging Quicker Than Discharging?</h1>

<p>Let&rsquo;s look at just the charging phase for a second. We&rsquo;ll call the voltage that the capacitor is trying to charge up to the <strong>target voltage</strong>.</p>

<p>By the laws of physics, a capacitor charges up to the target voltage <strong>asymptotically</strong>. So not only will the capacitor voltage never quite reach the target voltage, but it will actually charge <strong>slower</strong> the closer it gets.</p>

<p>Let&rsquo;s consider a hypothetical setup where two capacitors, labeled $\text{A}$ and $\text{B}$, will be <strong>independently</strong> charging up from $0\text{ V}$. Suppose capacitor $\text{A}$ is trying to charge up to $1.001\text{ V}$ and capacitor $\text{B}$ is trying to charge up to $10^{6}\text{ V}$.</p>

<p>Which capacitor will reach $1\text{ V}$ <strong>first</strong>?</p>

<p>Well, as capacitor $\text{A}$&rsquo;s voltage starts approaching $1\text{ V}$, it&rsquo;s basically approaching its target voltage of $1.001\text{ V}$, so its charging will start to slow down rapidly. However, as capacitor $\text{B}$&rsquo;s voltage starts approaching $1\text{ V}$, it&rsquo;s still super far away from its target voltage of $10^{6}\text{ V}$, so its charging barely slows down.</p>

<p>So <strong>capacitor $\text{B}$</strong> will reach $1\text{ V}$ first!</p>

<p>What we&rsquo;ve just reasoned out is that <span class="highlight">the capacitor with the bigger gap between the target voltage and the cutoff voltage will charge the fastest.</span></p>

<hr />

<p><strong>Note:</strong> A capacitor <em>discharges</em> asymptotically as well, so these principles apply to a discharging capacitor just the same. That is, as a discharging capacitor&rsquo;s voltage approaches the target voltage, it starts to discharge slower.</p>

<p>Furthermore, if we designed a similar experiment as previously described but with two discharging capacitors, we would also find that the capacitor with the bigger gap between the target voltage and the cutoff voltage will discharge the fastest.</p>

<hr />

<p>Let&rsquo;s crunch some numbers to get a sense of how our circuit fares.</p>

<p>First up, <strong>how big is the gap between the charging target voltage and the high cutoff voltage?</strong> The high cutoff voltage is ${2}/{3}\ V_{CC}$, and the capacitor is trying to charge up to $V_{CC}$. So the gap is ${1}/{3}\ V_{CC}\approx$<span class="highlight">$1.67\text{ V}$</span></p>

<p>Up next, <strong>how big is the gap between the discharging target voltage and the low cutoff voltage?</strong> The low cutoff voltage is ${1}/{3}\ V_{CC}$. The voltage the capacitor is trying to discharge down to is given by</p>

<p>$$ \left(\frac{R_2}{R_1+R_2}\right) V_{CC} = \left(\frac{1\text{ MΩ}}{3\text{ MΩ}+1\text{ MΩ}}\right) V_{CC} = \frac{1}{4}\,V_{CC} $$</p>

<p>Thus, the gap is ${1}/{12}\ V_{CC}\approx$<span class="highlight">$0.42\text{ V}$</span></p>

<p>Since the gap between charging target voltage and the high cutoff voltage is <strong>bigger</strong> than the gap between the discharging target voltage and the low cutoff voltage, charging is <strong>faster</strong>.</p>

<p>As a visual aid, let&rsquo;s look at a graph showing the charging and discharging phases of $C_1$. Real quick though, <strong>let&rsquo;s change the discharging target voltage to $1.5\text{ V}$</strong>, which will decrease the gap between the discharging target voltage and the low cutoff voltage down to just $0.17\text{ V}$. <strong>This is just to make the effect of different sized gaps more visually apparent</strong>. It&rsquo;s worth pointing out that this situation corresponds to us using $R_1=2.33\text{ MΩ}$. This still satisfies the condition that $R_1&gt;2\,R_2$, and so the circuit would still oscillate.</p>

<p>Anyways, here&rsquo;s the various parts of the graph:</p>

<ul>
<li>The <strong>x-axis</strong> represents <strong>time</strong> and the <strong>y-axis</strong> represents <strong>voltage</strong></li>
<li>The <strong>blue curve</strong> is the voltage of $C_1$ during the <strong>charging</strong> phase</li>
<li>The <strong>red curve</strong> is the voltage of $C_1$ during the <strong>discharging</strong> phase</li>
<li>The <strong>black lines</strong> are the charging and discharging <strong>cutoff voltages</strong> and are at ${2}/{3}\ V_{CC}$ and ${1}/{3}\ V_{CC}$ respectively</li>
<li>The <strong>purple dotted lines</strong> are the charging and discharging <strong>target voltages</strong> and are at $V_{CC}=5\text{ V}$ and $1.5\text{ V}$ (remember we changed this) respectively</li>
<li><strong>Both phases start at $t=0$</strong></li>
<li>The <strong>green X&rsquo;s</strong> show when the <strong>capacitors hit their cutoffs</strong>, i.e. when the phases end</li>
</ul>

<p><img src="/images/555-R1/capacitor_graph.png#c" alt="graph showing the asymmetry between the charging and discharging phases" />
<div class="figure-caption">The discharge phase takes longer than the charging phase because the low cutoff voltage is closer to the discharging target voltage</div></p>

<p>It should now be easy to see that as the red curve approaches the low cutoff voltage, it&rsquo;s approaching the low target voltage as well, making it flatten out and slow down. The blue curve, however, seems to plow right through the high cutoff voltage, hardly slowing down.</p>

<h1 id="the-fix">The Fix</h1>

<p>The obvious solution is to move the discharge target voltage to be as close to $0\text{ V}$ as we can. That way the gap between the low cutoff voltage and the discharge target voltage will <em>also</em> be ${1}/{3}\ V_{CC}$.</p>

<p>The discharge target voltage is given by the voltage divider mentioned just a bit ago. To make the formula go to $0\text{ V}$, we can have $R_1$ go to $\infty\text{ Ω}$.</p>

<p>Of course, $\infty\text{ Ω}$ is not a resistor value that I have in my box, but the gist is that <span class="highlight">we need to make $R_1$ <em>really, really</em> big</span>.</p>

<p>Here&rsquo;s a GIF showing how increasing the value of $R_1$ makes the waveform look more like what we want.</p>

<p><img src="/images/555-R1/converge.gif#c" alt="animation showing how increasing the value of R1 improves the waveform" />
<div class="figure-caption">Simulating various values of $R_1$</div></p>

<p>One thing that should really pop out from the GIF is that $R_1$ doesn&rsquo;t just affect the duty cycle of the wave, <strong>it affects the frequency too</strong>. So having a large $R_1$ is <em>doubly</em> important to meeting the specifications.</p>

<p>Looks like having $R_1 = 50\text{ MΩ}$ would give us a good-looking wave.</p>

<h1 id="another-fix">Another Fix</h1>

<p>One small problem: I don&rsquo;t have a $50\text{ MΩ}$ resistor sitting in my kit...</p>

<p>Fortunately, there is something else we can do!</p>

<p>Recall (yet again) that the discharging target voltage for the capacitor, which we&rsquo;ll now call $V_{low}$, is determined by the formula:</p>

<p>$$ V_{low} = \left(\frac{R_2}{R_1+R_2}\right) V_{CC} $$</p>

<p>We need $V_{low} \approx 0\text{ V}$, and we originally thought to do that by taking $R_1$ to be a really large value.</p>

<p>But we can use a bit of algebra to instead write it like this:</p>

<p>$$ V_{low} = \left(\frac{1}{1+\frac{R_1}{R_2}}\right) V_{CC} $$</p>

<p>If we want $V_{low}\rightarrow 0\text{ V}$, we need to make ${R_1}/{R_2}\rightarrow\infty$. To that end, we can either make $R_1\rightarrow\infty\text{ Ω}$ as we did earlier, or we can instead make $R_2\rightarrow 0\text{ Ω}$</p>

<p>So <span class="highlight">rather than <em>increasing</em> $R_1$, we can instead <em>decrease</em> $R_2$!</span></p>

<p>Of course, remember that $R_2$ and $C_1$ together control the timing of the oscillator with the formula</p>

<p>$$ f=\frac{1}{0.693(2R_2)C_1}\,\text{ Hz} $$</p>

<p>From that formula we can clearly see that to keep $f$ the same, we just need to keep $R_2C_1$ the same. So if we <em>decrease</em> $R_2$ by some factor, we just need to <em>increase</em> $C_1$ by that <em>same</em> factor.</p>

<h1 id="the-final-circuit">The Final Circuit</h1>

<p>Let&rsquo;s put that to the test.</p>

<p>Here is an updated circuit where the value of $R_2$ has been <em>reduced</em> by a factor of $10$, the value of $C_1$ has been <em>increased</em> by a factor of $10$, and the value of $R_1$ has been <em>kept</em> at $3\text{ MΩ}$:</p>

<p><img src="/images/555-R1/schematic_ideal.png#c" alt="schematic of an ideal 555 50% duty cycle oscillator circuit" />
<div class="figure-caption">A more ideal circuit, built using more convenient values of $R_1$ and $R_2$. The changed values are boxed in red</div></p>

<p>Here is the corresponding simulation run:</p>

<p><img src="/images/555-R1/graph_ideal.png#c" alt="simulation of an ideal 555 50% duty cycle oscillator circuit" />
<div class="figure-caption">The &ldquo;perfect&rdquo; waveform created using more convenient values of $R_1$ and $R_2$</div></p>

<p>&nbsp;</p>

<p>Now <em>that&rsquo;s</em> what I&rsquo;m talking about!</p>

<h1 id="conclusion">Conclusion</h1>

<p>The Electronics Tutorial article gave this advice for choosing $R_1$:</p>

<blockquote>
<p>Note that resistor R1 needs to be sufficiently high enough to ensure it does not interfere with the charging of the capacitor to produce the required 50% duty cycle</p>
</blockquote>

<p>Now we know what &ldquo;sufficiently high enough&rdquo; means:</p>

<p><span class="num-circle">1</span> First and foremost, we need $R_1 &gt; 2\,R_2$ so that the 555 circuit actually oscillates.</p>

<p><span class="num-circle">2</span> To actually get the $50\%$ duty cycle (and whatever frequency we configured the 555 to produce), we need $R_1$ to be <em>much</em> bigger than $R_2$. We saw in the last section that a factor of $30$ seems to work.</p>

<p>As a rule of thumb, it helps to use a relatively small value of $R_2$ so that you don&rsquo;t need a humongous $R_1$.</p>

    </div>
  </div>
</section>
<footer class="section">
  <div class="container has-text-centered">
    <p>&copy; <a href="https://www.github.com/rchoudhary">Rutvik Choudhary</a> 2019</p>
    <p>Powered by <a href="https://gohugo.io/">Hugo</a> &amp; <a href="https://github.com/ribice/kiss">Kiss</a>.</p>
  </div>
</footer>


</body>
</html>

